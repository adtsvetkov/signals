# Большая лабораторная, обработка и интерпретация сигналов
## Как запустить алгоритм
### Jupyter Notebook
Открыть файл `Jupyter Notebook` **biglab.ipynb**, запускать помодульно.
### Python file
```{python}
$ git clone https://github.com/adtsvetkov/signals
$ cd signals
$ git checkout develop
$ pip install -r requirements.txt
$ python biglab.py
```
**Note:** в `Jupyter Notebook` рекомендуется использовать `Python v.3.8.4+`.   
`.py`-файл корректно работал на `Python v.3.9.4`.  
Тестовые данные находятся в папке `data`.

## Постановка задачи
**Вход:** фотографии, на которых изображен объект А — таз пластмассовый 10 л сиреневого цвета, и объект B — стол со столешницей темно-коричневых и бежевых оттенков, имеющий на столешнице набор прямых параллельных линиий, и металлическими глянцевыми ножками в количестве 4 шт. 

Необходимо понять, можно ли поместить объект А, под стол B. «Поместить» означает перемещение объекта А в одной плоскости в область под столешницей стола B без деформации объекта A.

Объект может поместиться под стол, если его размеры меньше, чем расстояние от пола до столешницы. Этому условию таз заранее удовлетворяет. Висеть над столом тазу запрещено: он может только лежать на полу, соприкасаясь или не соприкасаясь с ножками, или же на самой столешнице.
Таким образом, ответ "нет" получаем тогда, когда таз находится _над_ столом или на уровне столешницы. Ответ "да" получаем тогда, когда таз находится _под_ столом (под столешницей).

## Требования к входным данным

- Формат изображения Joint Photographic Experts Group (.jpeg, .jpg), соотношение сторон 9:16 (горизонтальная ориентация). Минимальный размер изображения 360 х 640.
- Объекты на фотографии хорошо различимы: резкие, не смазанные, находятся в фокусе, не шумные, отсутствует ретушь; нет пересвеченных или черных областей, цвета естественные.
- Фон за изучаемыми объектами светлый, контрастный с обоими объектами и их частями. 
- Пропорции объектов относительно друг друга сохраняются. Объекты находятся на фотографии целиком, т.е. не обрезаются краями изображения. Коллажи из двух и более изображений недопустимы. Оба объекта (стол B и таз А) обязательно присутствуют на изображении. Стол должен находиться близко к стене (фону), большая часть столешницы должна быть параллельна (или почти параллельна) стене.
- Оптика среднеугольная (fish-eye изображения недопустимы). Изображения имеют небольшое перспективное искажение или не имеют его совсем.

## Описание работы алгоритма

1. Для определения границ объектов, содержащихся на изображении, применяется фильтр Canny.
2. Затем к отфильтрованному изображению применяется преобразование Хафа для поиска прямых, задающих столешницу.
3. Прямые фильтруются в целях удаления прямых пола и лишних прямых на столешнице. Ограничивающей линией стола считается нижняя из оставшихся прямых.
4. С помощью бинаризации по оттенкам сиреневого находится маска таза.
5. Находится ограничивающий прямоугольник таза, а также экстремальные точки маски.
6. Если таз находится полностью (или больше его 75%) над прямой стола, ответ отрицательный - значит, таз находится на столе, и поместить его под стол параллельным переносом нельзя. Иначе ответ положительный.

## Пример работы алгоритма

**Ответ "да":**  ![yes](https://user-images.githubusercontent.com/41506048/114310174-99524180-9af2-11eb-97eb-bdd7d955874e.jpg)
**Ответ "нет":** ![yes](https://user-images.githubusercontent.com/41506048/114310415-62c8f680-9af3-11eb-9de6-2c8ffddbf140.jpg)

## Итоги

- Алгоритм работает хорошо на всех изображениях, однако иногда за нижнюю линию стола все же принимается линия кафеля/плинтуса, а не линия столешницы. Возможно, стоит смотреть, какие линии изначально упираются в края изображения, и считать их плинтусом/кафелем (поскольку стол целиком должен быть расположен на изображении, линии столешницы не могут быть крайними точками).
- В алгоритме предусмотрена проверка на резкое пересечение прямых для удаления последствий перспективного искажения, а также проверка на случай, если линия стола пересекается с маской таза. На рассмотренном датасете таких кейсов не возникает. 
